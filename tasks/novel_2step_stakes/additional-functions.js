var instructions_1a_text = function(){
	var instructions = ["<div align=center>Welcome to this HIT!<br><br>Please read all following instructions very carefully.<br><br>It takes some time, but otherwise you will not know what to do.</div>",
	"<div align=center>In this HIT, you will be taking a spaceship from earth<br> to look for space treasure on two different planets:<br><br><img style='margin:0px auto;display:block;height:200px' src='img/example_planets.png'/></div>", 
	"<div align=center>Each planet has one alien on it and each alien has its own space treasure mine.<br><br><img style='margin:0px auto;display:block;height:100px' src='img/example_aliens.png'/><br>Once you arrive to each planet, you will ask the alien for space treasure from its mine.</div>",
	"<div align=justify>When you ask the alien, you will find out whether you got space treasure, which looks like this:<br><br><img style='margin:0px auto;display:block' src='img/treasure_1.png'/><br>Sometimes, however, the alien will not bring up any treasure and you'll see an empty circle:<br><br><img style='margin:0px auto;display:block' src='img/noreward.png'/></div>",
	"<div align=justify>If an alien has a good mine, it means it can easily dig up a lot of space treasure for you:<br><br><img style='margin:0px auto;display:block' src='img/treasure_9.png'/><br>Another alien might have a bad mine that gives only a little treasure:<br><br><img style='margin:0px auto;display:block' src='img/treasure_1.png'/><br>The quality of each alien's mine will change during the game. Aliens with a bad mine might get to a part of the mine that has more treasure, and those with a good mine might find less space treasure later on.<br><br>Changes in an alien's mine will happen slowly. So, you have to focus to get as much treasure as possible by finding the alien with the best mine at each point in time.</div>",
	"<div align=justify>At the end of each trial, the pieces of space treasure that you earned will be converted to points.<br><Br>Each piece of space treasure will be worth one point.<br><br>For example, if you were to get 9 pieces of treasure, you would earn 9 points, but if you were to get 3 pieces of treasure, you would earn 3 points.</div>",
	"<div align=justify>Each time you encounter an alien on a planet, you should press the SPACE key to ask it to mine. You will then see how much treasure you earned. Try practicing a few times.</div>"];
	return instructions
};

var instructions_1b_text = function(){
	var instructions = ["<div align=center>You may have noticed that this alien's mine started out good, and then became less good over time. The mines of other aliens will all follow a unique pattern.<br><br>To see this, you are going to ask another alien for treasure a few times.</div>"];
	return instructions
};

var instructions_1c_text = function(){
	var instructions = ["<div align=justify>Now that you know about the treasure, you can learn how the travel to the planets works.<br><br>On each trial, you will travel from earth to one of two planets, a purple planet and a red planet:<br><br><img style='margin:0px auto;display:block;height:200px' src='img/example_planets.png'/></div>",
	"<div align=justify>On each trial, you will choose which spaceship to take. Each time, you'll be choosing between two different spaceships:<br><br><img style='margin:0px auto;display:block;height:100px' src='img/example_rockets.png'/><br>Sometimes, you'll be choosing between the two spaceships on the left, and sometimes you'll be choosing between the two spaceships on the right. You can choose the left spaceship by pressing the 'F' key and the right spaceship by pressing the 'J' key. <br><br>Each spaceship will fly to one of the two planets. For each pair, one spaceship will fly to the purple planet, and the other will fly to the red planet.</div>",
	"<div align=justify>Let's practice flying to the planets! First, try to pick the spaceships that will get you to the purple planet:<br><br><img style='margin:0px auto;display:block;height:200px' src='img/purple_planet.png'/></div>"];
	return instructions
};
var instructions_1d_text = function(){
	var instructions = "<div align=center>Very good!<br><br>Now, try to pick the spaceships that will get you to the red planet:<br><br><br><img style='margin:0px auto;display:block;height:200px' src='img/red_planet.png'/></div>";
	return instructions
};

var instructions_1e_text = function(){
	var instructions = ["<div align=center>You now know how to fly to the planets and how the space treasure works, so you are ready to practice them together.<br><br>Each time, you will pick a spaceship to fly to a planet and then ask the alien to mine for you.<br><br>Your goal will be to get as much treasure as possible.</div>",
	"<div align=justify>Hint #1:<br>Remember which aliens have treasure. How good a mine is changes slowly, so an alien that has a lot of treasure to share now will probably be able to share a lot in the near future.<br><br>Hint #2:<br>Remember, each alien has its own mine. Just because one alien has a bad mine, does not mean another has a good mine. Also, there are no funny patterns in how much treasure an alien shares. The aliens are not tricking you.<br><br>Hint #3:<br>The spaceship you choose is important because often the alien on one planet is better than the ones on another planet. You can find more treasure by finding the spaceship that takes you to the right planet.</div>",
	"<div align=justify>In the real experiment, we are only going to give you 1.5 seconds for each response (1.5 seconds for the spaceships, and 1.5 seconds for the alien). At the beginning that won't seem like very much time and you may find the task difficult. Over time, as you learn to play, you will find that 1.5 seconds is enough time to make good decisions.<br><br>Our advice is to think carefully about your strategy, but also to trust your instincts. By concentrating you can increase the number of points you win by a lot. There is an element of chance, but a lot of room for skill as well.<br><br>Now, you will do 25 practice trials. These don't count, and have no time limit in order to help you learn.</div>"];
	return instructions
};

var instructions_2_text = function(){
	var instructions_2 = ["<div align=justify>Great job! There's one more thing you need to learn before you can start the real experiment.<br><br>From now on, at the start of trial you will see one of these two displays:<br><br><img style='margin:0px auto;display:block;height:100px' src='img/example_values.png'/><br>These displays are called 'point multipliers'. They indicate that the points that you earn on the following trial will be multiplied by the number on the display.<br><br>So, if you see the display on the left, the one that says '1x', each piece of treasure will be worth 1 point, just like in all previous practice phases.<br><br>However, if you see the display on the right, the one that says '5x', the stakes of that trial are raised. On these trials, the points you earn will be multiplied by 5. This means that each piece of space treasure will be worth 5 points!</div>",
	"<div align=justify>Let's see how this works. For example, let's say that you would see the '5x' point multiplier at the start of the trial:<br><br><img style='margin:0px auto;display:block;height:100px' src='img/5x.png'/><br>Then, if you were to get 3 pieces of space treasure, your total score would go up 15 points.<br><br>However, if you were to get 9 pieces of treasure, your total score would go up 45 points.<br><br>It is important to know that which of the two point multipliers you see on each trial is chosen COMPLETELY RANDOMLY. This means that there is no way to predict what it will be on the next trial.</div>",
	"<div align=justify>To make sure you understand how the point multipliers work, you will practice a few trials of the full task.<br><br>On each trial, you will be asked to calculate the number of points you earned based on the number of pieces of treasure and the current point multiplier.<br><br>You can answer with any number between by using the number keys. You can clear the answer with the 'z' key. Press the space bar to confirm your answer.</div>"];
	return instructions_2
}

var instructions_3_text = function(){
	var instructions_2 = ["<div align=justify>Ok, you've finished all practice phases. In the real game, you will find new aliens with new mines on the two planets, but everything else will be the same.<br><br>Let's review everything we've learned and then begin playing.<br><br>Remember, you want to find as much space treasure as you can by flying to planets and asking an alien to mine for you. How much treasure comes out of each alien's mine changes slowly over time, so you need to concentrate and be flexible to keep track of which spaceships and aliens are good right now.</div>",
	"<div align=justify>On each trial, you will see a points multiplier, which indicates that the points you earn on that trial will be multiplied by the number given on the display.<br><br>The number on the points multiplier display is chosen completely RANDOMLY on each trial, so there is no way to predict what it will be on the next trial.</div>",
	"<div align=justify>The rocket ships will always be on screen for 1.5 seconds, even after you already made a decision. Because of this, you will not be able to finish the experiment faster by making your decisions more quickly. Every MTurk worker will complete the HIT in exactly the same time, so use the time you have for each decision to your advantage!<br><br>You will get a bonus payment of 1 dollar cent for every 36 points you earn. On average people win about $1.00, and some have won more than $2.50.<br><br>The game lasts for 200 trials and you will have 1.5 seconds for each choice, and that takes about 30 minutes.<br><br>You will be given the opportunity for a break in the middle of the HIT.<br><br>The HIT will start after you press 'next', make sure you have your fingers on the 'F' and the 'J' keys! Good luck!</div>"];
	return instructions_2
}

function createMemberInNormalDistribution(mean,std_dev){
	return mean + (gaussRandom()*std_dev);
}
/*
* Returns random number in normal distribution centering on 0.
* ~95% of numbers returned should fall between -2 and 2
*/
function gaussRandom() {
	var u = 2*Math.random()-1;
	var v = 2*Math.random()-1;
	var r = u*u + v*v;
	/*if outside interval [0,1] start over*/
	if(r == 0 || r > 1) return gaussRandom();

	var c = Math.sqrt(-2*Math.log(r)/r);
	return u*c;

	/* todo: optimize this algorithm by caching (v*c) 
	* and returning next time gaussRandom() is called.
	* left out for simplicity */
}

function shuffle(o){
	for(var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
	return o;
}

var images = [
'img/earth_planet.png',
'img/earth_stim_1_deact.png',
'img/earth_stim_1.png',
'img/earth_stim_2_deact.png',
'img/earth_stim_2.png',
'img/earth_stim_3_deact.png',
'img/earth_stim_3.png',
'img/earth_stim_4_deact.png',
'img/earth_stim_4.png',
'img/example_aliens.png',
'img/example_planets.png',
'img/example_rockets.png',
'img/example_values_2.png',
'img/example_values.png',
'img/noreward.png',
'img/p_purple_planet.png',
'img/p_purple_stim_deact.png',
'img/p_purple_stim_happy.png',
'img/p_purple_stim_sad.png',
'img/p_purple_stim.png',
'img/p_red_planet.png',
'img/p_red_stim_deact.png',
'img/p_red_stim_happy.png',
'img/p_red_stim_sad.png',
'img/p_red_stim.png',
'img/purple_planet.png',
'img/purple_stim_deact.png',
'img/purple_stim_happy.png',
'img/purple_stim_sad.png',
'img/purple_stim.png',
'img/red_planet.png',
'img/red_stim_deact.png',
'img/red_stim_happy.png',
'img/red_stim_sad.png',
'img/red_stim.png',
'img/treasure_0.png',
'img/treasure_1.png',
'img/treasure_2.png',
'img/treasure_3.png',
'img/treasure_4.png',
'img/treasure_5.png',
'img/treasure_6.png',
'img/treasure_7.png',
'img/treasure_8.png',
'img/treasure_9.png',
'img/5x.png',
'img/1x.png',
];

function save_data(data,table_name){
	
for (i = 0; i < data.length; i++) {
	delete data[i].internal_chunk_id;
	delete data[i].trial_index_global;
	delete data[i].trial_type;
	}
		
	$.ajax({
		type:'post',
		cache: false,
		url: 'savedata.php', // change this to point to your php file.
		// opt_data is to add additional values to every row, like a subject ID
		// replace 'key' with the column name, and 'value' with the value.
		data: {
			table: table_name,
			json: JSON.stringify(data),
		},
		success: function(){
			console.log("hieperdepiep");
		}// write the result to javascript console
		//success: function(output) { console.log(output); } // write the result to javascript console
	});
}

function getQueryVariable(variable)
{
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
}